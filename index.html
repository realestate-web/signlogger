<!DOCTYPE html>
<html>
<head>
  <!-- (keep all your existing head, styles, etc.) -->
</head>
<body>
  <!-- (header + info-box + summary code unchanged) -->

  <!-- Hidden form that we’ll populate and submit -->
  <form id="logForm" method="GET" target="hiddenFrame" style="display:none">
    <input name="sign">
    <input name="signType">
    <input name="lat">
    <input name="lng">
    <input name="address">
    <input name="installer">
    <input name="notes">
    <input name="condition">
  </form>
  <iframe name="hiddenFrame" style="display:none"></iframe>

  <!-- Your visible inputs -->
  <select id="installer"> … </select>
  <select id="condition"> … </select>
  <textarea id="notes"> … </textarea>
  <button id="recordBtn">Record Installation</button>

  <script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbzExAYZaUDnLgCkG2gHYTMbfo5--jHCmhl7rTrxawQmuKsle54Pyt6dTmOnVhJ3xUaqIA/exec';
    const params    = new URLSearchParams(location.search);
    const sign      = params.get('sign')     || 'UNKNOWN';
    const signType  = params.get('signType') || 'Unknown';
    document.getElementById('sign').textContent     = sign;
    document.getElementById('signSize').textContent = signType;

    // initial summary load (unchanged)
    refreshSummary();

    document.getElementById('recordBtn').onclick = () => {
      navigator.geolocation.getCurrentPosition(async pos => {
        let address = '';
        try {
          const geo = await fetch(
            `https://maps.googleapis.com/maps/api/geocode/json`
            + `?latlng=${pos.coords.latitude},${pos.coords.longitude}`
            + `&key=AIzaSyDYOE-sqSuFAIZgMhlJtNQLdBG0jcDHILQ`
          ).then(r=>r.json());
          address = geo.results[0]?.formatted_address||'';
        } catch(e){}

        // Populate and submit hidden form
        const form      = document.getElementById('logForm');
        form.action     = scriptUrl;
        form.sign.value     = sign;
        form.signType.value = signType;
        form.lat.value      = pos.coords.latitude;
        form.lng.value      = pos.coords.longitude;
        form.address.value  = address;
        form.installer.value= document.getElementById('installer').value;
        form.notes.value    = document.getElementById('notes').value;
        form.condition.value= document.getElementById('condition').value;

        form.submit();
        // the Apps Script response will redirect the top window
      }, err => alert('Location error: ' + err.message));
    };
  </script>
</body>
</html>
