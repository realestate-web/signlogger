<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>Sign Logger POC</title></head>
<body style="font-family:sans-serif; padding:1em; text-align:center;">
  <h1>ğŸš€ SIGN LOGGER POC</h1>
  <h3>Logging Sign: <span id="sign">â€¦</span></h3>
  <p>Tap â€œRecord Installationâ€ and allow location access when prompted.</p>
  <button id="recordBtn" style="font-size:1.2em; padding:.5em 1em;">
    Record Installation
  </button>
  <script>
  // 1) Read the sign ID from the URL
  const sign = new URLSearchParams(location.search).get('sign') || 'UNKNOWN';
  document.getElementById('sign').textContent = sign;

  document.getElementById('recordBtn').onclick = () => {
    // Ask for location
    navigator.geolocation.getCurrentPosition(position => {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;

      // Reverse-geocode to a street address
      fetch(
        `https://maps.googleapis.com/maps/api/geocode/json`
        + `?latlng=${lat},${lng}`
        + `&key=AIzaSyDYOE-sqSuFAIZgMhlJtNQLdBG0jcDHILQ`
      )
      .then(res => res.json())
      .then(json => {
        const address = json.results[0]?.formatted_address || '';
        // 2) Redirect to your Apps-Script URL with all data in the query string
        const scriptUrl = 
          'https://script.google.com/macros/s/AKfycbzExAYZaUDnLgCkG2gHYTMbfo5--jHCmhl7rTrxawQmuKsle54Pyt6dTmOnVhJ3xUaqIA/exec';
        const params = new URLSearchParams({
          sign,
          lat:     lat.toString(),
          lng:     lng.toString(),
          address
        });
        window.location = scriptUrl + '?' + params.toString();
      })
      .catch(() => {
        alert('Reverse-geocode failed; please try again.');
      });
    }, err => {
      alert('Location error: ' + err.message);
    });
  };
</script>
</body>
</html>
